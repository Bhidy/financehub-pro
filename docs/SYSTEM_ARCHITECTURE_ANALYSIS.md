# FinanceHub Pro - Complete System Architecture Analysis
## Enterprise-Grade Financial Intelligence Platform

**Date:** January 23, 2026  
**Author:** Bhidy  
**Status:** Production (Hetzner VPS)  
**Version:** 4.4.0-STARTA-STRUCTURE

---

## ğŸ“Š Executive Summary

FinanceHub Pro (branded as **Starta**) is an enterprise-grade financial intelligence platform for MENA markets (Saudi Arabia, Egypt, GCC). The system extracts, processes, and visualizes stock market data with an AI-powered chatbot interface.

---

## ğŸ—ï¸ System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           FINANCEHUB PRO ARCHITECTURE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTPS     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   FRONTEND      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           BACKEND (Hetzner VPS)          â”‚ â”‚
â”‚  â”‚   (Vercel)      â”‚              â”‚     starta.46-224-223-172.sslip.io       â”‚ â”‚
â”‚  â”‚                 â”‚              â”‚                                          â”‚ â”‚
â”‚  â”‚ â€¢ Next.js 16    â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚ â€¢ React 19      â”‚              â”‚  â”‚         FastAPI Server             â”‚  â”‚ â”‚
â”‚  â”‚ â€¢ TailwindCSS   â”‚              â”‚  â”‚  â€¢ Python 3.11 + Uvicorn           â”‚  â”‚ â”‚
â”‚  â”‚ â€¢ TypeScript 5  â”‚              â”‚  â”‚  â€¢ Docker Container                â”‚  â”‚ â”‚
â”‚  â”‚ â€¢ Framer Motion â”‚              â”‚  â”‚  â€¢ Port 7860                       â”‚  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚                                   â”‚                    â”‚                      â”‚ â”‚
â”‚                                   â”‚                    â–¼                      â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  GitHub Actions â”‚â”€â”€Triggerâ”€â”€â”€â”€â–ºâ”‚  â”‚       AI Chat Engine               â”‚  â”‚ â”‚
â”‚  â”‚  (Watchdog)     â”‚              â”‚  â”‚  â€¢ Intent Router (Rule-Based)      â”‚  â”‚ â”‚
â”‚  â”‚  â€¢ Data Sync    â”‚              â”‚  â”‚  â€¢ Multi-LLM Fallback              â”‚  â”‚ â”‚
â”‚  â”‚  â€¢ Price Update â”‚              â”‚  â”‚    (Groq â†’ Cerebras â†’ Mistral)     â”‚  â”‚ â”‚
â”‚  â”‚  â€¢ AI Ingestion â”‚              â”‚  â”‚  â€¢ Symbol Resolver                 â”‚  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚  â€¢ 15+ Intent Handlers             â”‚  â”‚ â”‚
â”‚                                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚                                   â”‚                    â”‚                      â”‚ â”‚
â”‚                                   â”‚                    â–¼                      â”‚ â”‚
â”‚                                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚                                   â”‚  â”‚         DATABASE                   â”‚  â”‚ â”‚
â”‚                                   â”‚  â”‚      (Supabase PostgreSQL)         â”‚  â”‚ â”‚
â”‚                                   â”‚  â”‚  â€¢ 19.2M+ Data Points              â”‚  â”‚ â”‚
â”‚                                   â”‚  â”‚  â€¢ 210+ Stock Tickers              â”‚  â”‚ â”‚
â”‚                                   â”‚  â”‚  â€¢ User Portfolios                 â”‚  â”‚ â”‚
â”‚                                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Technology Stack

### Frontend (`/frontend`)
| Component | Technology | Version |
|-----------|------------|---------|
| Framework | Next.js (App Router) | 16.1.1 |
| UI Library | React | 19.2.3 |
| Styling | Tailwind CSS | v4 |
| Animation | Framer Motion | Latest |
| Charts | ApexCharts, Recharts, Lightweight Charts | - |
| State Management | TanStack Query (React Query) | - |
| Language | TypeScript | 5 |

### Backend (`/backend-core`)
| Component | Technology | Version |
|-----------|------------|---------|
| Framework | FastAPI | Latest |
| Runtime | Python | 3.11 |
| Server | Uvicorn | - |
| Container | Docker | - |
| Scheduler | APScheduler | - |
| ORM | asyncpg (raw SQL) | - |

### Infrastructure
| Component | Service | Details |
|-----------|---------|---------|
| Frontend Hosting | Vercel | CDN + Edge |
| Backend Hosting | Hetzner VPS | Docker |
| Database | Supabase PostgreSQL | Managed |
| SSL/Proxy | Caddy | Auto ACME |
| CI/CD | GitHub Actions | Watchdog |

---

## ğŸ“ Directory Structure

```
mubasher-deep-extract/
â”œâ”€â”€ frontend/                    # Next.js Application (Vercel)
â”‚   â”œâ”€â”€ app/                     # App Router Pages
â”‚   â”‚   â”œâ”€â”€ ai-analyst/          # Desktop AI Chat
â”‚   â”‚   â”œâ”€â”€ mobile-ai-analyst/   # Mobile AI Chat
â”‚   â”‚   â”œâ”€â”€ portfolio/           # Portfolio Management
â”‚   â”‚   â”œâ”€â”€ screener/            # Stock Screener
â”‚   â”‚   â”œâ”€â”€ api/                 # Next.js API Routes
â”‚   â”‚   â””â”€â”€ ...                  # 28+ pages
â”‚   â”œâ”€â”€ components/              # 41+ Reusable Components
â”‚   â”œâ”€â”€ hooks/                   # Custom React Hooks
â”‚   â”œâ”€â”€ lib/                     # API Client & Utilities
â”‚   â”‚   â”œâ”€â”€ api.ts               # Backend API Client
â”‚   â”‚   â”œâ”€â”€ ai-service.ts        # AI Service Integration
â”‚   â”‚   â””â”€â”€ auth.ts              # Authentication
â”‚   â””â”€â”€ contexts/                # React Contexts
â”‚
â”œâ”€â”€ backend-core/                # FastAPI Application (Hetzner)
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py              # Application Entry Point
â”‚   â”‚   â”œâ”€â”€ api/v1/              # API Endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ endpoints/       # 14 Endpoint Modules
â”‚   â”‚   â”‚   â””â”€â”€ router.py        # Route Registration
â”‚   â”‚   â”œâ”€â”€ chat/                # AI Chat Engine (Core)
â”‚   â”‚   â”‚   â”œâ”€â”€ chat_service.py  # Main Orchestrator
â”‚   â”‚   â”‚   â”œâ”€â”€ intent_router.py # Intent Classification
â”‚   â”‚   â”‚   â”œâ”€â”€ symbol_resolver.py # Ticker Resolution
â”‚   â”‚   â”‚   â”œâ”€â”€ llm_clients.py   # Multi-LLM Provider
â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/        # 15 Intent Handlers
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ services/            # Business Logic
â”‚   â”‚   â”‚   â”œâ”€â”€ scheduler.py     # Background Jobs
â”‚   â”‚   â”‚   â””â”€â”€ ai_service.py    # Legacy AI Service
â”‚   â”‚   â”œâ”€â”€ db/                  # Database Schemas
â”‚   â”‚   â””â”€â”€ core/                # Configuration
â”‚   â”œâ”€â”€ scripts/                 # Data Extraction Scripts
â”‚   â””â”€â”€ Dockerfile               # Container Definition
â”‚
â”œâ”€â”€ scripts/                     # Deployment & Utility Scripts
â”‚   â”œâ”€â”€ deploy_production.sh     # Unified Deployment
â”‚   â””â”€â”€ restore_production.exp   # Nuclear Recovery
â”‚
â”œâ”€â”€ .github/workflows/           # CI/CD Pipelines
â”‚   â””â”€â”€ enterprise-data-update.yml
â”‚
â””â”€â”€ .agent/workflows/            # Agent Automation Workflows
```

---

## ğŸ—„ï¸ Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ENTERPRISE DATABASE SCHEMA                               â”‚
â”‚                         ~19.2 Million Data Points                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚   market_tickers    â”‚â—„â”€â”€â”€â”€â”€â”€â–ºâ”‚    company_profiles â”‚                        â”‚
â”‚  â”‚   (Core Stock List) â”‚        â”‚   (Company Details) â”‚                        â”‚
â”‚  â”‚ â€¢ symbol (PK)       â”‚        â”‚ â€¢ sector, industry  â”‚                        â”‚
â”‚  â”‚ â€¢ name_en/ar        â”‚        â”‚ â€¢ description, CEO  â”‚                        â”‚
â”‚  â”‚ â€¢ last_price        â”‚        â”‚ â€¢ employees, HQ     â”‚                        â”‚
â”‚  â”‚ â€¢ market_cap        â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚  â”‚ â€¢ pe_ratio, beta    â”‚                                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚             â”‚                                                                   â”‚
â”‚             â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         PRICE DATA TABLES                               â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ ohlc_data      â”‚ Daily OHLC (10,577 pts/stock)                          â”‚   â”‚
â”‚  â”‚ intraday_1m    â”‚ 1-Minute (7 days history)                              â”‚   â”‚
â”‚  â”‚ intraday_5m    â”‚ 5-Minute (60 days, 25,186 pts)                         â”‚   â”‚
â”‚  â”‚ intraday_1h    â”‚ 1-Hour (2 years, 25,494 pts)                           â”‚   â”‚
â”‚  â”‚ weekly_ohlc    â”‚ Weekly aggregates                                      â”‚   â”‚
â”‚  â”‚ monthly_ohlc   â”‚ Monthly aggregates                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       FINANCIAL DATA TABLES                             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ financial_history  â”‚ Income/Balance/CashFlow (3000+ pts/stock)          â”‚   â”‚
â”‚  â”‚ valuation_history  â”‚ PE, PB, PS, EV ratios (130 pts/stock)              â”‚   â”‚
â”‚  â”‚ earnings_history   â”‚ EPS estimates/actuals                              â”‚   â”‚
â”‚  â”‚ dividend_history   â”‚ Ex-dates, amounts                                  â”‚   â”‚
â”‚  â”‚ analyst_consensus  â”‚ Ratings, targets                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       PORTFOLIO TABLES                                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ portfolios           â”‚ User portfolios (cash, currency)                 â”‚   â”‚
â”‚  â”‚ portfolio_holdings   â”‚ Stock positions (symbol, qty, avg_price)         â”‚   â”‚
â”‚  â”‚ portfolio_snapshots  â”‚ Historical valuations                            â”‚   â”‚
â”‚  â”‚ portfolio_transactionsâ”‚ Buy/Sell records with P&L                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¤– AI Chatbot Architecture

### Chatbot Processing Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AI CHAT MESSAGE PROCESSING FLOW                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                â”‚
â”‚  USER MESSAGE                                                                  â”‚
â”‚       â”‚                                                                        â”‚
â”‚       â–¼                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ 1. TEXT NORMALIZER  â”‚ â€¢ Slang/dialect translation                          â”‚
â”‚  â”‚                     â”‚ â€¢ Arabic normalization                                â”‚
â”‚  â”‚                     â”‚ â€¢ Symbol extraction                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚             â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ 2. COMPLIANCE CHECK â”‚ â€¢ Banned topics filter                               â”‚
â”‚  â”‚                     â”‚ â€¢ Disclaimer injection                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚             â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 3. INTENT ROUTER    â”‚â”€â”€â”€â–ºâ”‚ INTENT KEYWORDS (30+ Intents)               â”‚   â”‚
â”‚  â”‚   (Rule-Based)      â”‚    â”‚ â€¢ STOCK_PRICE, STOCK_SNAPSHOT               â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â€¢ DIVIDENDS, FINANCIALS                      â”‚   â”‚
â”‚  â”‚   Score keywords    â”‚    â”‚ â€¢ SCREENER, TOP_GAINERS/LOSERS              â”‚   â”‚
â”‚  â”‚   Pick highest      â”‚    â”‚ â€¢ DEEP_SAFETY/VALUATION/GROWTH              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â€¢ NEWS, EARNINGS, OWNERSHIP                 â”‚   â”‚
â”‚             â”‚               â”‚ â€¢ TECH_INDICATORS, CHART                     â”‚   â”‚
â”‚             â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 4. SYMBOL RESOLVER  â”‚â”€â”€â”€â–ºâ”‚ Resolution Strategies                       â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â€¢ Direct ticker match (1120, COMI)          â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â€¢ Nickname dict (Al Rajhi â†’ 1120)           â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â€¢ Database fuzzy search                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â€¢ Context carryover from history            â”‚   â”‚
â”‚             â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 5. DISPATCH HANDLER â”‚â”€â”€â”€â–ºâ”‚ 15 Intent Handlers:                         â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â€¢ price_handler.py                           â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â€¢ financials_handler.py                      â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â€¢ chart_handler.py                           â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â€¢ screener_handler.py                        â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â€¢ deep_dive_handler.py                       â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â€¢ dividends_handler.py                       â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â€¢ news_handler.py                            â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â€¢ statistics_handler.py                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                                                                  â”‚
â”‚             â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 6. LLM EXPLAINER (Multi-Provider Fallback)                               â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” fail â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” fail â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚ â”‚
â”‚  â”‚   â”‚  GROQ   â”‚â”€â”€â”€â”€â”€â–ºâ”‚ CEREBRAS  â”‚â”€â”€â”€â”€â”€â–ºâ”‚ MISTRAL  â”‚                      â”‚ â”‚
â”‚  â”‚   â”‚ Primary â”‚      â”‚ Secondary â”‚      â”‚ Tertiary â”‚                      â”‚ â”‚
â”‚  â”‚   â”‚ 100K/dayâ”‚      â”‚14.4K req/dâ”‚      â”‚ 1B/month â”‚                      â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚   Generates: conversational_text, fact_explanations                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚             â”‚                                                                  â”‚
â”‚             â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚ 7. RESPONSE BUILDER â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     â”‚â”€â”€â”€â–ºâ”‚ 4-LAYER RESPONSE (PROTECTED)                â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚                                             â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â‘  Greeting/Opening (Personalized)           â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â‘¡ Data Cards (Stock info, metrics)          â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â‘¢ Learning Section (ğŸ“Š Educational)         â”‚   â”‚
â”‚  â”‚                     â”‚    â”‚ â‘£ Follow-up Prompt (ğŸ’¡ Next action)         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                                                                  â”‚
â”‚             â–¼                                                                  â”‚
â”‚       CHAT RESPONSE                                                            â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow Architecture

### Live Data Update Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATA UPDATE PIPELINE                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     GITHUB ACTIONS WATCHDOG                              â”‚  â”‚
â”‚  â”‚                 (enterprise-data-update.yml)                             â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  SCHEDULE:                                                               â”‚  â”‚
â”‚  â”‚  â€¢ */5 6-13 * * 0-4  = Every 5 min during market hours (Prices)         â”‚  â”‚
â”‚  â”‚  â€¢ 0 15 * * 0-4      = 6 PM Saudi (Daily OHLC Sync)                     â”‚  â”‚
â”‚  â”‚  â€¢ 0 16 * * 0-4      = 7 PM Saudi (Egypt Funds)                         â”‚  â”‚
â”‚  â”‚  â€¢ 0 17 * * 0-4      = 8 PM Saudi (AI Ingestion)                        â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                                                                 â”‚
â”‚               â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    SYNCHRONOUS POLLING PATTERN                           â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚   1. POST /api/v1/admin/refresh/{type}  â”€â”€â–º Trigger Job                 â”‚  â”‚
â”‚  â”‚   2. LOOP: GET /api/v1/admin/refresh/status                             â”‚  â”‚
â”‚  â”‚   3. Check: is_running == false â†’ Exit                                   â”‚  â”‚
â”‚  â”‚   4. Sleep 10s â†’ Repeat                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                                                                 â”‚
â”‚               â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     BACKEND SCHEDULER SERVICE                            â”‚  â”‚
â”‚  â”‚                     (app/services/scheduler.py)                          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â”‚  JOBS:                                                                   â”‚  â”‚
â”‚  â”‚  â€¢ run_market_job_silent  â†’ Price updates (every 5 min)                 â”‚  â”‚
â”‚  â”‚  â€¢ run_ohlc_catchup_job   â†’ Daily OHLC backfill (every 4 hours)         â”‚  â”‚
â”‚  â”‚  â€¢ run_maintenance_job    â†’ DB cleanup                                   â”‚  â”‚
â”‚  â”‚  â€¢ run_decypha_job        â†’ Funds data                                   â”‚  â”‚
â”‚  â”‚  â€¢ run_mubasher_job       â†’ Saudi market data                           â”‚  â”‚
â”‚  â”‚                                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                                                                 â”‚
â”‚               â–¼                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                       DATA SOURCES                                       â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚   MUBASHER    â”‚    YAHOO      â”‚   DECYPHA     â”‚     STOCKANALYSIS        â”‚  â”‚
â”‚  â”‚   (Primary)   â”‚   (Backup)    â”‚   (Funds)     â”‚     (Fallback)           â”‚  â”‚
â”‚  â”‚               â”‚               â”‚               â”‚                          â”‚  â”‚
â”‚  â”‚ Saudi OHLC    â”‚ Intl metrics  â”‚ Egypt Funds   â”‚  Company profiles        â”‚  â”‚
â”‚  â”‚ Egypt prices  â”‚ Financials    â”‚ NAV data      â”‚  Financials              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Deployment Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DEPLOYMENT ARCHITECTURE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  DEVELOPER MACHINE                                                              â”‚
â”‚       â”‚                                                                         â”‚
â”‚       â”‚ ./scripts/deploy_production.sh [frontend|backend|all]                  â”‚
â”‚       â”‚                                                                         â”‚
â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚       â”‚                                          â”‚                              â”‚
â”‚       â–¼                                          â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  FRONTEND (Vercel)  â”‚                â”‚ BACKEND (Hetzner)   â”‚                 â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
â”‚  â”‚                     â”‚                â”‚                     â”‚                 â”‚
â”‚  â”‚ 1. Verify root dir  â”‚                â”‚ 1. git add/commit   â”‚                 â”‚
â”‚  â”‚ 2. npx vercel --prodâ”‚                â”‚ 2. git push main    â”‚                 â”‚
â”‚  â”‚ 3. Build & Deploy   â”‚                â”‚                     â”‚                 â”‚
â”‚  â”‚                     â”‚                â”‚ NUCLEAR OPTION:     â”‚                 â”‚
â”‚  â”‚ Output:             â”‚                â”‚ 3. SSH â†’ Server     â”‚                 â”‚
â”‚  â”‚ startamarkets.com   â”‚                â”‚ 4. docker down      â”‚                 â”‚
â”‚  â”‚                     â”‚                â”‚ 5. system prune -af â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚ 6. docker up --buildâ”‚                 â”‚
â”‚                                         â”‚                     â”‚                 â”‚
â”‚                                         â”‚ Output:             â”‚                 â”‚
â”‚                                         â”‚ starta.46-224-...   â”‚                 â”‚
â”‚                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                                 â”‚
â”‚  CRITICAL RULES:                                                                â”‚
â”‚  âœ— NEVER cd into frontend/ before Vercel deploy                                â”‚
â”‚  âœ— NEVER use HuggingFace (completely banned)                                   â”‚
â”‚  âœ— NEVER run local cron jobs (cloud-only)                                       â”‚
â”‚  âœ“ ALWAYS use nuclear option for reliable deploys                              â”‚
â”‚  âœ“ ALWAYS check df -h before large builds                                       â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           AUTHENTICATION SYSTEM                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      AUTH METHODS                                       â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  1. EMAIL/PASSWORD                                                      â”‚   â”‚
â”‚  â”‚     POST /api/v1/auth/register                                          â”‚   â”‚
â”‚  â”‚     POST /api/v1/auth/login                                             â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  2. OTP (One-Time Password)                                             â”‚   â”‚
â”‚  â”‚     POST /api/v1/auth/request-otp                                       â”‚   â”‚
â”‚  â”‚     POST /api/v1/auth/verify-otp                                        â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â”‚  3. GOOGLE OAUTH                                                        â”‚   â”‚
â”‚  â”‚     GET  /api/v1/auth/google                                            â”‚   â”‚
â”‚  â”‚     GET  /api/v1/auth/google/callback                                   â”‚   â”‚
â”‚  â”‚                                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  TOKEN FLOW:                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Login    â”‚â”€â”€â”€â–ºâ”‚   JWT      â”‚â”€â”€â”€â–ºâ”‚ Store in   â”‚â”€â”€â”€â–ºâ”‚ Attach to  â”‚         â”‚
â”‚  â”‚            â”‚    â”‚  Token     â”‚    â”‚ localStorageâ”‚   â”‚ API calls  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ API Endpoints Summary

### Backend API Routes (`/api/v1/`)

| Prefix | Module | Description |
|--------|--------|-------------|
| `/auth` | auth.py, otp_auth.py, google_auth.py | Authentication |
| `/ai` | ai.py | Chat API |
| `/market` | market.py | Tickers, sectors, screener |
| `/portfolio` | portfolio.py | User portfolios |
| `/yahoo` | yahoo.py | Yahoo Finance data |
| `/company` | company.py | Company profiles |
| `/egx` | egx.py | Egypt EGX data |
| `/admin` | admin.py | Data management, refresh |
| `/admin/analytics` | analytics_router.py | Chat analytics |
| `/user` | user.py | User profile |
| `/trading` | trading.py | Trade operations |

---

## ğŸ“ˆ Key Metrics

| Metric | Value |
|--------|-------|
| Total Database Tables | 15+ |
| Data Points | ~19.2 Million |
| Stock Tickers | 210+ (Saudi + Egypt) |
| Frontend Pages | 28+ |
| React Components | 40+ |
| Backend Endpoints | 14 modules |
| Chat Intent Types | 30+ |
| Chat Handlers | 15 |
| LLM Providers | 3 (Groq, Cerebras, Mistral) |

---

## ğŸ”’ Critical Protected Components

| Component | File | Protection Level |
|-----------|------|------------------|
| 4-Layer Response Structure | chat_service.py (lines 504-540) | ğŸ”´ CRITICAL |
| Narrative Generation | llm_explainer.py | ğŸ”´ CRITICAL |
| Mobile AI Rendering | mobile-ai-analyst/page.tsx | ğŸ”´ CRITICAL |
| Desktop AI Rendering | ai-analyst/page.tsx | ğŸ”´ CRITICAL |
| Response Types | useAIChat.ts | ğŸŸ  HIGH |
| Learning Generator | learning_section_generator.py | ğŸŸ  HIGH |
| Follow-up Generator | follow_up_generator.py | ğŸŸ  HIGH |

---

## âš¡ Performance Considerations

1. **Database Indexing**: All price tables indexed on (symbol, date DESC)
2. **Connection Pooling**: asyncpg with connection reuse
3. **LLM Caching**: Frequently used explanations cached
4. **CDN**: Vercel Edge for frontend static assets
5. **Background Jobs**: APScheduler for non-blocking updates

---

## ğŸ¯ Conclusion

FinanceHub Pro is a sophisticated, production-ready financial intelligence platform with:
- **Robust Architecture**: Separated frontend/backend with clear API contracts
- **AI-First Design**: Rule-based routing + Multi-LLM for natural conversations
- **Enterprise Data**: 19.2M+ data points with automated updates
- **Production-Grade**: Docker, CI/CD, multi-provider failover
- **Protected Components**: Critical chatbot structure preserved

---

*Generated by System Architecture Analysis - January 23, 2026*
