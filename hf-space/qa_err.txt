ğŸš€ [QA] Starting Expert Production Test against: https://bhidy-financehub-api.hf.space
Testing Turn 1: Symbol Resolution (CIB)...
DEBUG Turn 1 Response: {'message_text': "ğŸ“Š **Commercial International Bank Egypt (CIB) S.A.E.** (COMI)\n\nğŸ’° **Price:** EGP 104.30 â†‘ (+1.25%) ğŸ“ˆ\n\nğŸ“ˆ **Today's Range:** 103.40 - 105.58\nğŸ”“ **Open:** 103.01 | **Prev Close:** 104.30\nğŸ“¦ **Volume:** 3.73M\n\nğŸ¢ **Sector:** Commercial Banks", 'message_text_ar': None, 'language': 'en', 'cards': [{'type': 'stock_header', 'title': None, 'data': {'symbol': 'COMI', 'name': 'Commercial International Bank Egypt (CIB) S.A.E.', 'market_code': 'EGX', 'currency': 'EGP', 'sector': 'Commercial Banks', 'as_of': '2026-01-11T14:15:37.108607+00:00'}}, {'type': 'snapshot', 'title': None, 'data': {'last_price': 104.3, 'change': 0.0, 'change_percent': 1.252, 'volume': 3729539, 'open': 103.01, 'high': 105.58, 'low': 103.4, 'prev_close': 104.3, 'currency': 'EGP', 'trend_emoji': 'ğŸ“ˆ'}}, {'type': 'stats', 'title': 'Valuation & Stats', 'data': {'pe_ratio': 5.17, 'dividend_yield': 0.0226, 'market_cap': 352320000000, 'market_cap_formatted': '352.32B'}}], 'chart': None, 'actions': [{'label': 'ğŸ“Š View Chart', 'label_ar': 'ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø±Øª', 'action_type': 'query', 'payload': 'Chart COMI'}, {'label': 'ğŸ’° Financials', 'label_ar': 'ğŸ’° Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ©', 'action_type': 'query', 'payload': 'COMI financials'}, {'label': 'ğŸ’µ Dividends', 'label_ar': 'ğŸ’µ Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª', 'action_type': 'query', 'payload': 'COMI dividends'}, {'label': 'ğŸ‘¥ Shareholders', 'label_ar': 'ğŸ‘¥ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…ÙŠÙ†', 'action_type': 'query', 'payload': 'COMI shareholders'}, {'label': 'âš™ï¸ Technicals', 'label_ar': 'âš™ï¸ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠ Ø§Ù„ÙÙ†ÙŠ', 'action_type': 'query', 'payload': 'COMI technicals'}], 'disclaimer': None, 'meta': {'intent': 'STOCK_PRICE', 'confidence': 0.57, 'entities': {'term': 'the price of cib', 'symbol': 'COMI', 'market_code': 'EGX'}, 'latency_ms': 1733, 'cached': False, 'as_of': '2026-01-11T23:14:33.334214', 'backend_version': '2.6'}}
âœ… Turn 1 Passed.
Testing Turn 2: Financials (Keyword-only)...
DEBUG Turn 2 Response: {'message_text': 'ğŸ“Š Found **189** funds\n\n1. **ABC Bank Equity Fund 1**\n\n2. **ABC Bank Money Market Fund - Mazaya**\n\n3. **Abu Dhabi Islamic Bank Money Market Fund**\n\n4. **Agricultural Bank of Egypt and Banque du Caire Fund - Al Wefak**\n\n5. **Ahli United Bank Balanced Fund I**\n\n6. **Ahli United Bank Money Market Fund**\n\n7. **Ahli United Bank of Egypt Equity Investment Fund - Alfa**\n\n8. **Al Ahly for Development and Investment Money Market Fund - Al Ahly**\n\n9. **Al Baraka Bank Egypt Balanced Fund - Al Mizan**\n\n10. **Al Baraka Bank Egypt fund - Al Baraka Certificate**\n\n\n... and 179 more', 'message_text_ar': None, 'language': 'en', 'cards': [{'type': 'fund_list', 'title': 'Available Funds', 'data': {'count': 189, 'funds': [{'fund_id': 'EGYACUM', 'name': 'ABC Bank Equity Fund 1', 'nav': None, 'returns_ytd': None, 'is_shariah': False}, {'fund_id': 'EGYUB1', 'name': 'ABC Bank Money Market Fund - Mazaya', 'nav': None, 'returns_ytd': None, 'is_shariah': False}, {'fund_id': 'EGYADIB1', 'name': 'Abu Dhabi Islamic Bank Money Market Fund', 'nav': None, 'returns_ytd': None, 'is_shariah': False}, {'fund_id': 'EGYABE1', 'name': 'Agricultural Bank of Egypt and Banque du Caire Fund - Al Wefak', 'nav': None, 'returns_ytd': None, 'is_shariah': False}, {'fund_id': 'EGYAUB2', 'name': 'Ahli United Bank Balanced Fund I', 'nav': None, 'returns_ytd': None, 'is_shariah': False}, {'fund_id': 'EGYAUB1', 'name': 'Ahli United Bank Money Market Fund', 'nav': None, 'returns_ytd': None, 'is_shariah': False}, {'fund_id': 'EGYAUB3', 'name': 'Ahli United Bank of Egypt Equity Investment Fund - Alfa', 'nav': None, 'returns_ytd': None, 'is_shariah': False}, {'fund_id': 'EGYADI1', 'name': 'Al Ahly for Development and Investment Money Market Fund - Al Ahly', 'nav': None, 'returns_ytd': None, 'is_shariah': False}, {'fund_id': 'EGYALMZN', 'name': 'Al Baraka Bank Egypt Balanced Fund - Al Mizan', 'nav': None, 'returns_ytd': None, 'is_shariah': False}, {'fund_id': 'EGYABBE2', 'name': 'Al Baraka Bank Egypt fund - Al Baraka Certificate', 'nav': None, 'returns_ytd': None, 'is_shariah': False}, {'fund_id': 'EGYABBE1', 'name': 'Al Baraka Bank Egypt Money Market Fund - Al Barakat Certificate', 'nav': None, 'returns_ytd': None, 'is_shariah': False}, {'fund_id': 'EGYEFGBCM', 'name': 'Al Baraka Capital Islamic - Manasek Fund', 'nav': None, 'returns_ytd': None, 'is_shariah': False}, {'fund_id': 'EGYHRMBRQ', 'name': 'Al Barq', 'nav': None, 'returns_ytd': None, 'is_shariah': False}, {'fund_id': 'EGYALHAY', 'name': 'Al Hayat Islamic Equity Fund', 'nav': None, 'returns_ytd': None, 'is_shariah': False}, {'fund_id': 'EGYHELAL', 'name': 'Al Helal', 'nav': None, 'returns_ytd': None, 'is_shariah': False}]}}], 'chart': None, 'actions': [{'label': 'â˜ªï¸ Shariah Funds', 'label_ar': 'â˜ªï¸ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø´Ø±Ø¹ÙŠØ©', 'action_type': 'query', 'payload': 'shariah funds'}, {'label': 'ğŸ“ˆ Top Funds', 'label_ar': 'ğŸ“ˆ Ø£ÙØ¶Ù„ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚', 'action_type': 'query', 'payload': 'top funds'}], 'disclaimer': None, 'meta': {'intent': 'FUND_SEARCH', 'confidence': 0.68, 'entities': {'sector': 'Financial Services', 'symbol': 'COMI', 'market_code': 'EGX'}, 'latency_ms': 387, 'cached': False, 'as_of': '2026-01-11T23:14:36.313204', 'backend_version': '2.6'}}
Traceback (most recent call last):
  File "/Users/home/Documents/Info Site/mubasher-deep-extract/hf-space/testsprite_tests/TC003_ai_analyst_chatbot_financial_insights_relevance.py", line 71, in <module>
    test_ai_chatbot_production()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/home/Documents/Info Site/mubasher-deep-extract/hf-space/testsprite_tests/TC003_ai_analyst_chatbot_financial_insights_relevance.py", line 40, in test_ai_chatbot_production
    assert resp2["meta"]["intent"] == "FINANCIALS", f"Wrong intent: {resp2['meta']['intent']}"
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError: Wrong intent: FUND_SEARCH
