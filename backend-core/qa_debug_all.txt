ğŸš€ [QA] Starting Expert Production Test against: https://bhidy-financehub-api.hf.space
Testing Turn 1: Symbol Resolution (CIB)...
DEBUG Turn 1 Response: {'message_text': "ğŸ“Š **Commercial International Bank Egypt (CIB) S.A.E.** (COMI)\n\nğŸ’° **Price:** EGP 104.30 â†‘ (+1.25%) ğŸ“ˆ\n\nğŸ“ˆ **Today's Range:** 103.40 - 105.58\nğŸ”“ **Open:** 103.01 | **Prev Close:** 104.30\nğŸ“¦ **Volume:** 3.73M\n\nğŸ¢ **Sector:** Commercial Banks", 'message_text_ar': None, 'language': 'en', 'cards': [{'type': 'stock_header', 'title': None, 'data': {'symbol': 'COMI', 'name': 'Commercial International Bank Egypt (CIB) S.A.E.', 'market_code': 'EGX', 'currency': 'EGP', 'sector': 'Commercial Banks', 'as_of': '2026-01-11T14:15:37.108607+00:00'}}, {'type': 'snapshot', 'title': None, 'data': {'last_price': 104.3, 'change': 0.0, 'change_percent': 1.252, 'volume': 3729539, 'open': 103.01, 'high': 105.58, 'low': 103.4, 'prev_close': 104.3, 'currency': 'EGP', 'trend_emoji': 'ğŸ“ˆ'}}, {'type': 'stats', 'title': 'Valuation & Stats', 'data': {'pe_ratio': 5.17, 'dividend_yield': 0.0226, 'market_cap': 352320000000, 'market_cap_formatted': '352.32B'}}], 'chart': None, 'actions': [{'label': 'ğŸ“Š View Chart', 'label_ar': 'ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø±Øª', 'action_type': 'query', 'payload': 'Chart COMI'}, {'label': 'ğŸ’° Financials', 'label_ar': 'ğŸ’° Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ©', 'action_type': 'query', 'payload': 'COMI financials'}, {'label': 'ğŸ’µ Dividends', 'label_ar': 'ğŸ’µ Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª', 'action_type': 'query', 'payload': 'COMI dividends'}, {'label': 'ğŸ‘¥ Shareholders', 'label_ar': 'ğŸ‘¥ Ø§Ù„Ù…Ø³Ø§Ù‡Ù…ÙŠÙ†', 'action_type': 'query', 'payload': 'COMI shareholders'}, {'label': 'âš™ï¸ Technicals', 'label_ar': 'âš™ï¸ Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠ Ø§Ù„ÙÙ†ÙŠ', 'action_type': 'query', 'payload': 'COMI technicals'}], 'disclaimer': None, 'meta': {'intent': 'STOCK_PRICE', 'confidence': 0.57, 'entities': {'term': 'the price of cib', 'symbol': 'COMI', 'market_code': 'EGX'}, 'latency_ms': 1685, 'cached': False, 'as_of': '2026-01-11T23:21:09.932682', 'backend_version': '2.6'}}
âœ… Turn 1 Passed.
Testing Turn 2: Valuation Stats (COMI)...
DEBUG Turn 2 Response: {'message_text': 'ğŸ“Š **Comprehensive Statistics for Commercial International Bank Egypt (CIB) S.A.E.** (COMI)\n\nğŸ’° **Valuation Ratios:**\nâ€¢ P/E Ratio: 5.17\nâ€¢ P/B Ratio: 1.69\nâ€¢ P/S Ratio: 2.84\n\nğŸ“ˆ **Financial Efficiency:**\nâ€¢ ROE: 43.30%\nâ€¢ ROA: 6.06%\nâ€¢ ROIC: N/A\n\nğŸ’µ **Margins:**\nâ€¢ Gross Margin: N/A\nâ€¢ Operating Margin: 82.10%\nâ€¢ Profit Margin: 60.44%\n\nâš–ï¸ **Financial Health:**\nâ€¢ Current Ratio: N/A\nâ€¢ Debt/Equity: N/A\n\nğŸ“‰ **Technical Indicators:**\nâ€¢ Beta (5Y): 0.42\nâ€¢ RSI (14): 54.82', 'message_text_ar': None, 'language': 'en', 'cards': [{'type': 'stock_header', 'title': None, 'data': {'symbol': 'COMI', 'name': 'Commercial International Bank Egypt (CIB) S.A.E.', 'market_code': 'EGX', 'currency': 'EGP'}}, {'type': 'error', 'title': 'Full Statistics', 'data': {'valuation': {'pe_ratio': 5.17, 'pb_ratio': 1.69, 'ps_ratio': 2.84, 'forward_pe': 5.41, 'peg_ratio': None}, 'efficiency': {'roe': 0.433, 'roa': 0.0606, 'roic': None}, 'margins': {'gross_margin': None, 'operating_margin': 0.821, 'profit_margin': 0.6044}, 'financial_health': {'current_ratio': None, 'quick_ratio': None, 'debt_equity': None}, 'technical': {'beta_5y': 0.42, 'rsi_14': 54.82, 'ma_50d': 101.04, 'ma_200d': 86.08}}}], 'chart': None, 'actions': [{'label': 'ğŸ“ˆ Chart', 'label_ar': 'ğŸ“ˆ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ', 'action_type': 'query', 'payload': 'Chart COMI'}, {'label': 'ğŸ’° Dividends', 'label_ar': 'ğŸ’° Ø§Ù„ØªÙˆØ²ÙŠØ¹Ø§Øª', 'action_type': 'query', 'payload': 'COMI dividends'}, {'label': 'ğŸ“‹ Financials', 'label_ar': 'ğŸ“‹ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø§Ù„ÙŠØ©', 'action_type': 'query', 'payload': 'COMI financials'}], 'disclaimer': 'Data is for informational purposes only. This is not investment advice.', 'meta': {'intent': 'STOCK_STAT', 'confidence': 0.5, 'entities': {'symbol': 'COMI', 'market_code': 'EGX'}, 'latency_ms': 1689, 'cached': False, 'as_of': '2026-01-11T23:21:13.566828', 'backend_version': '2.6'}}
âœ… Turn 2 Passed.
Testing Turn 3: Technical Indicators (Aramco)...
DEBUG Turn 3 Response: {'message_text': "I'm having trouble processing your request. Please try again.", 'message_text_ar': 'Ø£ÙˆØ§Ø¬Ù‡ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'language': 'en', 'cards': [], 'chart': None, 'actions': [], 'disclaimer': None, 'meta': {'intent': 'ERROR', 'confidence': 0, 'entities': {}, 'latency_ms': 0, 'error': 'column "revenue_growth" does not exist'}}
Traceback (most recent call last):
  File "/Users/home/Documents/Info Site/mubasher-deep-extract/hf-space/testsprite_tests/TC003_ai_analyst_chatbot_financial_insights_relevance.py", line 74, in <module>
    test_ai_chatbot_production()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/home/Documents/Info Site/mubasher-deep-extract/hf-space/testsprite_tests/TC003_ai_analyst_chatbot_financial_insights_relevance.py", line 49, in test_ai_chatbot_production
    assert "rsi" in resp3["message_text"].lower() or any(c["type"] == "technicals" for c in resp3["cards"])
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError
